const raw = require("./chord-list-raw");

const lines = raw().split("\n");

const cleanName = str =>
  str
    .trim()
    .replace("&Delta;", "Δ")
    .replace("(none)", "")
    .replace("♭", "b")
    .replace("&deg;", "°")
    .replace("<sup>&oslash;</sup>", "ø")
    .replace("♯", "#");

const IVLS = {
  1: "1P",
  2: "2M",
  b2: "2m",
  3: "3M",
  "5": "5P",
  "7": "7M",
  "♭3": "3m",
  "4": "4P",
  "♯4": "4A",
  "♭5": "5d",
  "♯5": "5A",
  "♭6": "6m",
  "6": "6M",
  "♭♭7": "7d",
  "♭7": "7m",
  "(7)": "7M",
  "♭9": "9m",
  "(♭9)": "9m",
  "(9)": "9M",
  "9": "9M",
  "♯9": "9A",
  "♯11": "11A",
  "11": "11P",
  "(11)": "11P",
  "13": "13M"
};
const cleanInterval = str => {
  if (str === "") return null;
  if (str.indexOf(",") !== -1) return null;
  return IVLS[str] || "$$$" + str;
};

let currentType;
const type = line => {
  if (line === "==Major==") currentType = "M";
  if (line === "==Minor==") currentType = "m";
  if (line === "==Other==") currentType = "Other";
  if (line === "==Dominant/Seventh==") currentType = "Dom";
  if (line === "'''Diminished''") currentType = "dim";
  if (line === "==Polychords==") currentType = "Poly";
  if (line === "==Quartal Chords==") currentType = null;
  console.log("//", line);
};
const subtype = line => console.log("//", line);

const row = line => {
  if (!currentType) return;
  let [notes, fullname, names] = line.split("||");
  notes = notes
    .slice(1)
    .trim()
    .replace("<nowiki>|</nowiki>", "")
    .replace("/", "")
    .replace(", ", ",")
    .replace("(5)", "5")
    .split(" ")
    .map(cleanInterval)
    .filter(x => x)
    .join(" ");

  fullname = fullname
    .trim()
    .replace("<nowiki>|</nowiki>", "|")
    .replace("♭", "b")
    .replace("♯", "#");
  names = names
    .trim()
    .split(",")
    .map(cleanName)
    .join(" ");

  console.log(`"${notes}": ["${fullname}", "${names}"],`);
};

console.log("module.exports = {");
lines.forEach(line => {
  if (line.startsWith("==")) type(line);
  if (line.startsWith("'''")) subtype(line);
  // if (line.startsWith("{|")) console.log("table", line);
  // if (line.startsWith("|}")) console.log("end table", line);
  if (line.startsWith("| ")) row(line);
});

console.log("}");
